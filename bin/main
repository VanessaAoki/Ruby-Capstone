#!/usr/bin/env ruby

require 'nokogiri'
require 'open-uri'
require 'watir'
require 'webdrivers'
require_relative '../lib/test'
require_relative '../lib/display'

def fetch_terms(input)
  puts @display.request_terms
  @input = gets.chomp.split
  while @input.empty?
    puts @display.invalid_terms
    fetch_terms(input)
  end
end

def keep_printing(input)
  puts @display.continue_article
  @input = gets.chomp.capitalize
  case @input
  when 'Y'
    px = @nokogiri.css('div.mw-parser-output > p').text
    fetch_next(input)
  when 'N'
    fetch_next(input)
  else
    puts @display.invalid_continue
    keep_printing(input)
  end
end

def fetch_next(input)
  puts @display.fetch_again
  @input = gets.chomp
  case @input
  when '1'
    run_main
  when '2'
    puts @display.goodbye
  else
    puts @display.invalid_again
    fetch_next(input)
  end
end

def run_main
  @display = Display.new
  fetch_terms(@input)
  @search = Search.new(@input)
  @search.browser_new
  keep_printing(@input)
end

run_main